theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
plot(p)
}
#long data form
data1_10yr_sf <- right_join(MA_mcd_2010, data1_10yr, by = c("GEOID" = "new.GEOID"))
data1_10yr_sf_long <- data1_10yr_sf %>%
pivot_longer(cols = as.character(seq(1930, 2020, 10)),
names_to  = c("year")) %>%
rename("npop" = "value")
data1_10yr_sf_long$npop_cat <- cut(data1_10yr_sf_long$npop/1000,
breaks = c(0, 1, 3, 6, 9, 12, 15, 900),
labels = c("(0, 1]", "(1, 3]", "(3, 6]",
"(6, 9]", "(9, 12]", "(12, 15]", "> 15"),
include.lowest = T)
ggplot() +
geom_sf(data = data1_10yr_sf_long,
aes(fill = npop_cat),color = NA) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 1930 to 2020") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
View(data1_10yr)
data3_sf <- left_join(data3.origin, MA_mcd_2010, by = c("Municipality" = "match_name"))
MA_mcd_2010$NAME
MA_mcd_2010 <- county_subdivisions(state = "MA", cb = T, year = 2010, class = "sf")
MA_mcd_2010$match_name <- sub(" Town$", "", MA_mcd_2010$NAME)
data3.origin$Municipality[data3.origin$Municipality == "Manchester"] <- "Manchester-by-the-Sea"
data3_sf <- left_join(data3.origin, MA_mcd_2010, by = c("Municipality" = "match_name"))
View(data3_sf
)
plot(st_geometry(MA_mcd_2020))
plot(st_geometry(MA_mcd_2010))
data3.age.sex.town.origin <- read_xlsx(file.path(project_dir, "data/MA_donahue/UMDI_V2024_Long-Term_Population_Projections_MCD,_County,_RPA,_State_Age_Sex_detail_2010-2050.xlsx"), sheet = 2)
data3.age.sex.county.origin <- read_xlsx(file.path(project_dir, "data/MA_donahue/UMDI_V2024_Long-Term_Population_Projections_MCD,_County,_RPA,_State_Age_Sex_detail_2010-2050.xlsx"), sheet = 4)
data3.age.sex.RPA.origin <- read_xlsx(file.path(project_dir, "data/MA_donahue/UMDI_V2024_Long-Term_Population_Projections_MCD,_County,_RPA,_State_Age_Sex_detail_2010-2050.xlsx"), sheet = 6)
data3.age.sex.state.origin <- read_xlsx(file.path(project_dir, "data/MA_donahue/UMDI_V2024_Long-Term_Population_Projections_MCD,_County,_RPA,_State_Age_Sex_detail_2010-2050.xlsx"), sheet = 8)
View(data3.age.sex.town.origin)
#data3 with spatial info
MA_mcd_2010$match_name <- sub(" Town$", "", MA_mcd_2010$NAME)
data3.age.sex.town.origin$Municipality[data3.age.sex.town.origin$Municipality == "Manchester"] <- "Manchester-by-the-Sea"
data3_town_sf <- right(MA_mcd_2010, data3.age.sex.town.origin, by = c("match_name" = "Municipality"))
data3_town_sf <- right_join(MA_mcd_2010, data3.age.sex.town.origin, by = c("match_name" = "Municipality"))
colnames(data3_town_sf)
as.character(c(2010, seq(2020, 2050, 5)))
data3_town_sf_long <- data3_town_sf %>%
pivot_longer(cols = as.character(c(2010, seq(2020, 2050, 5))),
names_to  = c("year")) %>%
rename("npop" = "value")
View(data3_town_sf_long)
summary(data3_town_sf_long$npop)
data3_town_sf_long$npop_cat <- cut(data3_town_sf_long$npop,
breaks = c(0, 100, 200, 400, 600, 800, 1000, 2e6),
labels = c("(0, 100]", "(100, 200]", "(200, 400]",
"(400, 600]", "(600, 800]", "(800, 1000]", "> 1000"),
include.lowest = T)
ggplot() +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat),color = NA) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long,color = "grey50") +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat),color = NA) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long,color = "grey50", alpha = 0.8) +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat),color = NA) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long,color = "grey50", linewidth = 1, alpha = 0.8) +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat),color = NA) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat, color = "grey50"),color = NA) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat, color = "grey50"), linewidth = 1.1) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat, color = "grey50"), linewidth = 0.1) +
scale_fill_brewer(palette="YlOrRd", na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long, aes(color = "grey50"))
ggplot() +
geom_sf(data = data3_town_sf_long, aes(color = "blue")) +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat),color = NA) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long, aes(color = "blue"))
ggplot() +
geom_sf(data = data3_town_sf_long, color = "navy", size = 1) +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat),color = NA) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long, ase(color = "navy"), size = 1) +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat),color = NA) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long, aes(color = "navy"), size = 1) +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat),color = NA) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long, aes(color = "navy"), size = 1)
ggplot() +
geom_sf(data = data3_town_sf_long,
color = "navy",      # <- fixed style, not a mapping
linewidth = 1) +
theme_void()
ggplot() +
geom_sf(data = data3_town_sf_long,
color = "navy",      # <- fixed style, not a mapping
linewidth = 1)
ggplot() +
geom_sf(data = data3_town_sf_long,
color = "grey50",      # <- fixed style, not a mapping
linewidth = 1)
ggplot() +
geom_sf(data = data3_town_sf_long, color = "grey50") +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat),color = NA)
ggplot() +
geom_sf(data = data3_town_sf_long, color = "grey50") +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat), color = "grey50") +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long, color = "grey50", alpha = 0.8) +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat), color = "grey50") +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
ggplot() +
geom_sf(data = data3_town_sf_long, color = "grey50", alpha = 0.8, linewidth 0.2) +
ggplot() +
geom_sf(data = data3_town_sf_long, color = "grey50", alpha = 0.8, linewidth = 0.2) +
geom_sf(data = data3_town_sf_long,
aes(fill = npop_cat), color = "grey50") +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
#long data form
data1_1yr_sf <- right_join(MA_mcd_2010, data1_1yr, by = c("GEOID" = "new.GEOID"))
library(readxl)
library(dplyr)
library(tidyr)
library(tigris)
library(sf)
library(ggplot2)
library(ggsci)
options(tigris_use_cache = TRUE)
home_dir <- path.expand("~")
project_dir <- file.path(home_dir, "Library/CloudStorage/OneDrive-UTHealthHouston/MA Analysis/MA_MATRIS")
data1.origin <- read_xlsx(file.path(project_dir, "data/MA_donahue/Population_1930_to_2023.xlsx"), sheet = 1, skip = 3)
data2.origin <- read_xlsx(file.path(project_dir, "data/MA_donahue/UMDI_V2023_County_Characteristics_Estimates_Appendix.xlsx"), sheet = 2)
data3.age.sex.town.origin <- read_xlsx(file.path(project_dir, "data/MA_donahue/UMDI_V2024_Long-Term_Population_Projections_MCD,_County,_RPA,_State_Age_Sex_detail_2010-2050.xlsx"), sheet = 2)
data3.age.sex.county.origin <- read_xlsx(file.path(project_dir, "data/MA_donahue/UMDI_V2024_Long-Term_Population_Projections_MCD,_County,_RPA,_State_Age_Sex_detail_2010-2050.xlsx"), sheet = 4)
data3.age.sex.RPA.origin <- read_xlsx(file.path(project_dir, "data/MA_donahue/UMDI_V2024_Long-Term_Population_Projections_MCD,_County,_RPA,_State_Age_Sex_detail_2010-2050.xlsx"), sheet = 6)
data3.age.sex.state.origin <- read_xlsx(file.path(project_dir, "data/MA_donahue/UMDI_V2024_Long-Term_Population_Projections_MCD,_County,_RPA,_State_Age_Sex_detail_2010-2050.xlsx"), sheet = 8)
#download shapefile
county_shp <- counties(state = "MA", cb = TRUE, year = 2020, class = "sf")
MA_mcd_2010 <- county_subdivisions(state = "MA", cb = T, year = 2010, class = "sf")
split_cols <- do.call(rbind, strsplit(MA_mcd_2010$GEO_ID, "US"))
MA_mcd_2010$GEOID <- split_cols[ ,2]
MA_mcd_2010$match_name <- sub(" Town$", "", MA_mcd_2010$NAME)
#delete meaning less rows
data1 <- data1.origin[!is.na(data1.origin$CouSub), ]
colnames(data1)[3] <- "GEOID"
data1$GEOID <- as.character(data1$GEOID)
data1$new.GEOID <- ifelse(data1$GEOID == "2501724960", "2501724925", data1$GEOID)
data1_sf <- right_join(MA_mcd_2010, data1, by = c("GEOID" = "new.GEOID"))
data1_10yr <- data1 %>% select("Cnty", "CouSub", "new.GEOID", "Area Name",
as.character(seq(1930, 2000, 10)), "2010...14", "2020...15") %>%
rename("2010" = "2010...14",
"2020" = "2020...15")
data1_1yr <- data1 %>% select("Cnty", "CouSub", "new.GEOID", "Area Name",
"2010...20", as.character(seq(2011, 2019, 1)),
"2020...30", "2021", "2022", "2023") %>%
rename("2010" = "2010...20",
"2020" = "2020...30")
head(data1_10yr)
head(data1_1yr)
head(data2.origin)
head(data3.age.sex.town.origin)
#long data form
data1_10yr_sf <- right_join(MA_mcd_2010, data1_10yr, by = c("GEOID" = "new.GEOID"))
data1_10yr_sf_long <- data1_10yr_sf %>%
pivot_longer(cols = as.character(seq(1930, 2020, 10)),
names_to  = c("year")) %>%
rename("npop" = "value")
data1_10yr_sf_long$npop_cat <- cut(data1_10yr_sf_long$npop/1000,
breaks = c(0, 1, 3, 6, 9, 12, 15, 900),
labels = c("(0, 1]", "(1, 3]", "(3, 6]",
"(6, 9]", "(9, 12]", "(12, 15]", "> 15"),
include.lowest = T)
ggplot() +
geom_sf(data = data1_10yr_sf_long, color = "grey50", alpha = 0.8, linewidth = 0.2) +
geom_sf(data = data1_10yr_sf_long,
aes(fill = npop_cat),color = NA) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 1930 to 2020") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
#long data form
data1_1yr_sf <- right_join(MA_mcd_2010, data1_1yr, by = c("GEOID" = "new.GEOID"))
data1_1yr_sf_long <- data1_1yr_sf %>%
pivot_longer(cols = as.character(seq(2010, 2023, 1)),
names_to  = c("year")) %>%
rename("npop" = "value")
data1_1yr_sf_long$npop_cat <- cut(data1_1yr_sf_long$npop/1000,
breaks = c(0, 1, 3, 6, 9, 12, 15, 900),
labels = c("(0, 1]", "(1, 3]", "(3, 6]",
"(6, 9]", "(9, 12]", "(12, 15]", "> 15"),
include.lowest = T)
ggplot() +
geom_sf(data = data1_1yr_sf_long, color = "grey50", alpha = 0.8, linewidth = 0.2) +
geom_sf(data = data1_1yr_sf_long,
aes(fill = npop_cat),color = NA) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 2010 to 2023") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
data3_town_sf_long_female <- data3_town_sf_long %>% filter(Sex == "Female")
View(data3_town_sf_long_female)
all.age <- unique(data3_town_sf_long$`Age Group`)
#data3 with spatial info
MA_mcd_2010$match_name <- sub(" Town$", "", MA_mcd_2010$NAME)
data3.age.sex.town.origin$Municipality[data3.age.sex.town.origin$Municipality == "Manchester"] <- "Manchester-by-the-Sea"
data3_town_sf <- right_join(MA_mcd_2010, data3.age.sex.town.origin, by = c("match_name" = "Municipality"))
data3_town_sf_long <- data3_town_sf %>%
pivot_longer(cols = as.character(c(2010, seq(2020, 2050, 5))),
names_to  = c("year")) %>%
rename("npop" = "value")
data3_town_sf_long$npop_cat <- cut(data3_town_sf_long$npop,
breaks = c(0, 100, 200, 400, 600, 800, 1000, 2e6),
labels = c("(0, 100]", "(100, 200]", "(200, 400]",
"(400, 600]", "(600, 800]", "(800, 1000]", "> 1000"),
include.lowest = T)
data3_town_sf_long_female <- data3_town_sf_long %>% filter(Sex == "Female")
all.age <- unique(data3_town_sf_long$`Age Group`)
for (i in all.age) {
ggplot() +
geom_sf(data = data3_town_sf_long_female, color = "grey50", alpha = 0.8, linewidth = 0.2) +
geom_sf(data = data3_town_sf_long_female[data3_town_sf_long_female$`Age Group` == i, ],
aes(fill = npop_cat), color = "grey50") +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle(paste0("Trend of Population by towns/municipalities for Female, Age Group", i)) +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
}
#data3 with spatial info
MA_mcd_2010$match_name <- sub(" Town$", "", MA_mcd_2010$NAME)
data3.age.sex.town.origin$Municipality[data3.age.sex.town.origin$Municipality == "Manchester"] <- "Manchester-by-the-Sea"
data3_town_sf <- right_join(MA_mcd_2010, data3.age.sex.town.origin, by = c("match_name" = "Municipality"))
data3_town_sf_long <- data3_town_sf %>%
pivot_longer(cols = as.character(c(2010, seq(2020, 2050, 5))),
names_to  = c("year")) %>%
rename("npop" = "value")
data3_town_sf_long$npop_cat <- cut(data3_town_sf_long$npop,
breaks = c(0, 100, 200, 400, 600, 800, 1000, 2e6),
labels = c("(0, 100]", "(100, 200]", "(200, 400]",
"(400, 600]", "(600, 800]", "(800, 1000]", "> 1000"),
include.lowest = T)
data3_town_sf_long_female <- data3_town_sf_long %>% filter(Sex == "Female")
all.age <- unique(data3_town_sf_long$`Age Group`)
for (i in all.age) {
p2 <- ggplot() +
geom_sf(data = data3_town_sf_long_female, color = "grey50", alpha = 0.8, linewidth = 0.2) +
geom_sf(data = data3_town_sf_long_female[data3_town_sf_long_female$`Age Group` == i, ],
aes(fill = npop_cat), color = "grey50") +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle(paste0("Trend of Population by towns/municipalities for Female, Age Group", i)) +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
plot(p2)
}
ggplot() +
geom_sf(data = data3_town_sf_long_female, color = "grey50", alpha = 0.8, linewidth = 0.2) +
geom_sf(data = data3_town_sf_long_female[data3_town_sf_long_female$`Age Group` == i, ],
aes(fill = npop_cat), color = "grey50")
ggplot() +
geom_sf(data = data3_town_sf_long_female, color = "grey50", alpha = 0.8, linewidth = 0.2) +
geom_sf(data = data3_town_sf_long_female[data3_town_sf_long_female$`Age Group` == i, ],
aes(fill = npop_cat), color = "grey50") +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~ year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle(paste0("Trend of Population by towns/municipalities for Female, Age Group", i)) +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
p2 <- ggplot() +
geom_sf(data = data3_town_sf_long_female, color = "grey50", alpha = 0.8, linewidth = 0.2) +
geom_sf(data = data3_town_sf_long_female[data3_town_sf_long_female$`Age Group` == i, ],
aes(fill = npop_cat), color = "grey50") +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~ year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle(paste0("Trend of Population by towns/municipalities for Female, Age Group", i)) +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
plot(p2)
unique(data3_town_sf_long$`Age Group`)
#data3 with spatial info
MA_mcd_2010$match_name <- sub(" Town$", "", MA_mcd_2010$NAME)
data3.age.sex.town.origin$Municipality[data3.age.sex.town.origin$Municipality == "Manchester"] <- "Manchester-by-the-Sea"
data3_town_sf <- right_join(MA_mcd_2010, data3.age.sex.town.origin, by = c("match_name" = "Municipality"))
data3_town_sf_long <- data3_town_sf %>%
pivot_longer(cols = as.character(c(2010, seq(2020, 2050, 5))),
names_to  = c("year")) %>%
rename("npop" = "value")
data3_town_sf_long$npop_cat <- cut(data3_town_sf_long$npop,
breaks = c(0, 100, 200, 400, 600, 800, 1000, 2e6),
labels = c("(0, 100]", "(100, 200]", "(200, 400]",
"(400, 600]", "(600, 800]", "(800, 1000]", "> 1000"),
include.lowest = T)
data3_town_sf_long_female <- data3_town_sf_long %>% filter(Sex == "Female")
all.age <- unique(data3_town_sf_long$Age)
for (i in all.age) {
p2 <- ggplot() +
geom_sf(data = data3_town_sf_long_female, color = "grey50", alpha = 0.8, linewidth = 0.2) +
geom_sf(data = data3_town_sf_long_female[data3_town_sf_long_female$Age == i, ],
aes(fill = npop_cat), color = "grey50") +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~ year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle(paste0("Trend of Population by towns/municipalities for Female, Age Group", i)) +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
plot(p2)
}
p2 <- ggplot() +
geom_sf(data = data3_town_sf_long_female, color = "grey50", alpha = 0.8, linewidth = 0.2) +
geom_sf(data = data3_town_sf_long_female[data3_town_sf_long_female$Age == i, ],
aes(fill = npop_cat), color = "grey50") +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~ year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle(paste0("Trend of Population by towns/municipalities for Female, Age Group", i)) +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7, size = 5),
axis.text.y = element_text(angle = 0, vjust = 0.7, size = 5),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
plot(p2)
p2 <- ggplot() +
geom_sf(data = data3_town_sf_long_female, color = "grey50", alpha = 0.8, linewidth = 0.2) +
geom_sf(data = data3_town_sf_long_female[data3_town_sf_long_female$Age == i, ],
aes(fill = npop_cat), color = "grey50") +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~ year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle(paste0("Trend of Population by towns/municipalities for Female, Age Group", i)) +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
plot(p2)
ggplot() +
#geom_sf(data = data1_10yr_sf_long, color = "grey50", alpha = 0.8, linewidth = 0.2) +
geom_sf(data = data1_10yr_sf_long,
aes(fill = npop_cat),color = "grey50", alpha = 0.8, linewidth = 0.2) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle("Trend of Population (per k) by towns/municipalities from 1930 to 2020") +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
p2 <- ggplot() +
geom_sf(data = data3_town_sf_long_female[data3_town_sf_long_female$Age == i, ],
aes(fill = npop_cat), color = "grey50", alpha = 0.8, linewidth = 0.2) +
scale_fill_brewer(palette="YlOrRd",na.value = "grey50") +
facet_wrap(~ year) +
guides(fill=guide_legend(title="Population (per k)")) +
ggtitle(paste0("Trend of Population by towns/municipalities for Female, Age Group", i)) +
theme_bw() +
theme(axis.text.x = element_text(angle = 40, vjust = 0.7),
strip.background = element_rect(fill = "NA"),
strip.text.x = element_text(size = 10, colour = "black"))
plot(p2)
